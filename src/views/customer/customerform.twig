{% if customdata.customerform.errormessage|length != 0 %}
    <div class="pure-u-1">
        <div id="customerform-errortext">
            {% for error, errorstate in customdata.customerform.errormessage %}
                {{T("adrform_error_"~error)}}<br>
            {% endfor %}
        </div>
    </div>
{% endif %}

{% if customdata.customerform.purpose != 'shopadmin' %}
<form action="{{requesturi}}" name="customerform" id="customerform" method="POST" class="pure-form pure-form-aligned">
    <script language="JavaScript">
        $(document).ready(function() {
            $(".customerformfield").change(function() {
                $.post("/fs.php", $("#customerform").serialize());
            });
            {% if customdata.customerform.purpose == 'shoppingcart' %}
            $("#addrform-country").change(function() {
                $.ajax({
                    type: "POST",
                    url: "/_misc/updateshippingcost.html",
                    data: $("#addrform-country").serialize(),
                    success : function( resp ) {
                        $('#shcshippingvalue').html($('#shippingcostbrutto_new' , resp).html() + ' {{ currency }}');
                        $('#shcvatfullvalue').html($('#vatfull_new' , resp).html() + ' {{ currency }}');
                        $('#shcbruttovalue').html($('#totalbrutto_new' , resp).html() + ' {{ currency }}');
                    }
                });
            });
            {% endif %}
        });
    </script>
    <div class="pure-u-1 pure-u-md-3-5">
        <div id="customerform-address-wrapper">
            {% if customdata.customerform.purpose == 'shoppingcart' %}
                <input type="hidden" name="doCheckout" value="yes">
                <div id="customerform-address-header">{{ T("adrform_headline_shoppingcart") }}</div>
            {% elseif customdata.customerform.purpose == 'register' %}
                <input type="hidden" name="doRegister" value="yes">
            {% elseif customdata.customerform.purpose == 'admin' or customdata.customerform.purpose == 'editprofile' %}
                <input type="hidden" name="doEdit" value="yes">
            {% endif %}
            {% endif %}
            <fieldset>

                {% if customdata.customerform.purpose != 'register' %}
                <div class="pure-control-group">
                    <label for="addrform-custno">{{T("adrform_accountnumber")}}
                    </label><input type="text" name="custno"
                           value="{{customdata.customerform.fv_custno}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.custnoinvalid is defined or customdata.customerform.errormessage.custnoalreadytaken ? ' formerror' : '' }}"
                           id="addrform-custno" maxlength="5"{{ customdata.customerform.readonlycustno ? ' readonly' : ''}}>
                    {{ customdata.customerform.purpose != 'admin' and isloggedin == false ? T("adrform_ifavailable") : ' *' }}
                </div>
                {% endif %}

                <div class="pure-control-group">
                    <label id="label-mail" for="addrform-email">{{T("adrform_email")}}
                    </label><input type="email" name="email"
                           value="{{customdata.customerform.fv_email}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.email is defined or customdata.customerform.errormessage.emailalreadytaken is defined ? ' formerror' : '' }}"
                           id="addrform-email"{{ customdata.customerform.purpose == 'editprofile' or customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ not (customdata.customerform.readonly or customdata.customerform.purpose == 'editprofile') ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label for="addrform-corpname">{{T("adrform_corpname")}}
                    </label><input type="text" name="corpname"
                           value="{{customdata.customerform.fv_corpname}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.corpname is defined ? ' formerror' : '' }}"
                           id="addrform-corpname"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_corpname and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label id="label-Name" for="addrform-name">{{T("adrform_yourname")}}
                    </label><input type="text" name="name"
                           value="{{customdata.customerform.fv_name}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.name is defined ? ' formerror' : '' }}"
                           id="addrform-name"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_name and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label id="label-Strasse" for="addrform-street">{{T("adrform_street")}}
                    </label><input type="text" name="street"
                           value="{{customdata.customerform.fv_street}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.street is defined ? ' formerror' : '' }}"
                           id="addrform-street"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_street and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label id="label-PLZ" for="addrform-zip">{{T("adrform_zip")}}
                    </label><input type="text" name="zip"
                           value="{{customdata.customerform.fv_zip}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.zip is defined ? ' formerror' : '' }}"
                           id="addrform-zip"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_zip and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label id="label-Ort" for="addrform-town">{{T("adrform_town")}}
                    </label><input type="text" name="town"
                           value="{{customdata.customerform.fv_town}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.town is defined ? ' formerror' : '' }}"
                           id="addrform-town"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_town and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label id="label-telefon" for="addrform-phone">{{T("adrform_fon")}}
                    </label><input type="text" name="phone"
                                   value="{{customdata.customerform.fv_phone}}"
                                   class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.phone is defined ? ' formerror' : '' }}"
                                   id="addrform-phone"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_phone and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label for="addrform-cellphone">{{T("adrform_cellular")}}
                    </label><input type="text" name="cellphone"
                           value="{{customdata.customerform.fv_cellphone}}"
                           class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.cellphone is defined ? ' formerror' : '' }}"
                           id="addrform-cellphone"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {{ customdata.customerform.fr_cellphone and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                <label for="addrform-fax">{{T("adrform_fax")}}
                </label><input type="text" name="fax"
                       value="{{customdata.customerform.fv_fax}}"
                       class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.fax is defined ? ' formerror' : '' }}"
                       id="addrform-fax"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
        {{ customdata.customerform.fr_fax and not customdata.customerform.readonly ? ' *' : '' }}
                </div>

                <div class="pure-control-group">
                    <label id="label-country" for="addrform-country">{{T("adrform_country")}}
                    </label>{% if customdata.customerform.readonly
                    %}{{ macro.select("country", countrylist, customdata.customerform.fv_country, "addrform-country", 'pure-u-1 pure-u-md-3-4', true) }}{%
                    else %}{{ macro.select("country", countrylist, customdata.customerform.fv_country, "addrform-country", (customdata.customerform.errormessage.country is defined ? 'pure-u-1 pure-u-md-3-4 formerror' : 'pure-u-1 pure-u-md-3-4')) }}{{
                    customdata.customerform.fr_country ? ' *' : '' }}{%
                    endif %}
                </div>

                {% if customdata.customerform.purpose == 'admin' or customdata.customerform.purpose == 'shopadmin' %}
                <div class="pure-control-group">
                    <label for="addrform-custgroup">{{T("adrform_custgroup")}}
                    </label>{%
                    if customdata.customerform.purpose == 'admin' %}{{
                        macro.select('custgroup', customdata.customerform.fv_custgroups, customdata.customerform.fv_custgroup_selected, 'addrform-custgroup', 'pure-u-1 pure-u-md-3-4') }}{%
                    elseif customdata.customerform.purpose == 'shopadmin' %}<input
                        type="text" name="custgroup" id="addrform-custgroup" class="pure-u-1 pure-u-md-3-4"
                        value="{{customdata.customerform.fv_custgroup}}"{{ customdata.customerform.readonly ? ' readonly' : '' }}>
                    {% endif %}
                </div>
                {% endif %}

                {% if customdata.customerform.purpose == 'admin' or customdata.customerform.purpose == 'register' or customdata.customerform.purpose == 'editprofile' %}
                    <div class="pure-control-group">
                        <label for="addrform-pwd">{{T("adrform_password")}}
                        </label><input type="password" name="pwd"
                                       value="{{customdata.customerform.fv_pwd}}" class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.passwordlength is defined ? ' formerror' : '' }}"
                                       id="addrform-pwd">
                        {{ not (customdata.customerform.purpose == 'admin' or customdata.customerform.purpose == 'editprofile') ? ' *' : '' }}
                    </div>

                    <div class="pure-control-group">
                        <label for="addrform-pwdc">{{T("adrform_passwordconfirm")}}
                        </label><input type="password" name="pwdc"
                               value="{{customdata.customerform.fv_pwdc}}" class="pure-u-1 pure-u-md-3-4{{ customdata.customerform.errormessage.passwordmatch is defined ? ' formerror' : '' }}"
                               id="addrform-pwdc">
                    </div>
                {% endif %}

                {% if customdata.customerform.purpose == 'shoppingcart' %}
                    <div class="pure-control-group">
                        <label id="label-nachricht" for="addrform-remarks">{{T("adrform_remarks")}}
                        </label><textarea cols="20" rows="10" id="addrform-remarks" name="remarks" class="pure-u-1 pure-u-md-3-4">{{customdata.customerform.fv_remarks}}</textarea>
                    </div>
                {% endif %}

            </fieldset>
        </div>
    </div>{%
    if customdata.customerform.purpose == 'shoppingcart' %}<div
            class="pure-u-1 pure-u-md-2-5">
        {% set paymentmethodcount = customdata.customerform.fv_paymentmethods|length %}
        {% set paymentmethodloopfirst = true %}
        <div id="customerform-paymeht-wrapper">
            <div id="customerform-payment-header" for="zahlungsmethode" id="label-zahlung" class="required">
                {{T("adrform_paymentmethod")}}
            </div>

            {% for paymentmethod in customdata.customerform.fv_paymentmethods %}
            <div class="pure-controls customerform-payment">
                <label for="addrform-paymentmethod-{{paymentmethod}}" class="{{ customdata.customerform.errormessage.paymentmethod is defined ? ' formerror' : '' }}">
                    <input class="col-md-1 col-xs-1" type="radio" name="paymentmethod" id="addrform-paymentmethod-{{paymentmethod}}" value="{{paymentmethod}}"{{ paymentmethodcount == 1 or paymentmethod == customdata.customerform.fv_paymentmethod ? ' checked' : '' }}> {{T("order_paymentmethod_" ~ paymentmethod)}}<span class="pull-right"><img src="/_img/misc/icon_{{ paymentmethod }}.png" width="82px"></span>
                </label>
                {% set paymentmethodloopfirst = false %}
            </div>
            {% endfor %}

            <br class="clear">
        </div>
        {% endif %}

        {% if customdata.customerform.purpose == 'shoppingcart' or customdata.customerform.purpose == 'register' %}
        {% if not isloggedin %}
        <div id="customerform-tos-wrapper">
            <div class="pure-controls">
                <label{{ customdata.customerform.errormessage.tos is defined ? ' class=" formerror"' : '' }} id="label-agbs" for="addrform-tos">
                <input type="checkbox" name="tos" id="addrform-tos" value="y"{{ customdata.customerform.fv_tos ? ' checked' : '' }}>
                    {{T("adrform_tos")}}</label>
            </div>

            <div class="pure-controls">
                <label{{ customdata.customerform.errormessage.cancellationdisclaimer is defined ? ' class=" formerror"' : '' }} id="label-widerruf" for="addrform-cancellationdisclaimer">
                <input type="checkbox" name="cancellationdisclaimer" id="addrform-cancellationdisclaimer" value="y"{{ customdata.customerform.fv_cancellationdisclaimer ? ' checked' : '' }}>
                    {{T("adrform_cancellationdisclaimer")}}</label>
            </div>
        </div>
        {% endif %}
        {% endif %}

        {% if customdata.customerform.purpose == 'admin' %}
        <div id="customerform-admstate-wrapper">
            <div class="pure-controls">
                <label for="addrform-active">
                <input type="checkbox" name="active" id="addrform-active" value="y"{{ customdata.customerform.fv_active ? ' checked' : '' }}>
                    Aktiv</label>
            </div>
            <div class="pure-controls">
                <label for="addrform-emailverified">
                <input type="checkbox" name="emailverified" id="addrform-emailverified" value="y"{{ customdata.customerform.fv_emailverified ? ' checked' : '' }}>
                    E-Mail bestätigt</label>
            </div>
        </div>
        {% endif %}

        {% if customdata.customerform.purpose != 'shopadmin' and customdata.customerform.purpose != 'userhome' %}
            {% if customdata.customerform.purpose == 'shoppingcart' %}
                {% set customerform_submitstring = T("adrform_submit_shoppingcart") %}
            {% elseif customdata.customerform.purpose == 'register' %}
                {% set customerform_submitstring = T("adrform_submit_register") %}
            {% elseif customdata.customerform.purpose == 'editprofile' or customdata.customerform.purpose == 'admin' %}
                {% set customerform_submitstring = T("adrform_submit_editprofile") %}
            {% endif %}
            <div id="customerform-submit-wrapper"><button type="submit" class="pure-button pure-button-primary pure-u-1" id="customerform-submit" >{{customerform_submitstring}}</button></div>
        {% endif %}
    </div>
    {% if not customdata.customerform.readonly or customdata.customerform.purpose == 'admin' %}
        * {{T("adrform_requiredfield")}}<br><br>
    {% endif %}
    {% if customdata.customerform.purpose != 'shopadmin' %}
</form>
{% endif %}

{{customdata.customerform.html}}
